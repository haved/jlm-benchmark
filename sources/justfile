################ Creating sources-raw.json yourself ##############
###  This file is only relevant if you want to make            ###
###  your own set of sources*.json files from scratch.         ###
###  This is only for those who are particularily interested.  ###
###  You also must have your own cpu2017.tar.xz to do this     ###
##################################################################

_default:
    @just --list

# Builds all benchmarks while tracing the compilation commands
build-all-benchmarks:
    just programs/build-all-free
    just programs/build-cpu2017
    # Polybench is not built, as we are able to create compilation commands by hand

# After all benchmarks have been built and traced, create sources-raw.json
create-sources-raw-json:
    ./create_sources_raw_json.py --output sources-raw.json

# Creating the redist2017 version of sources.json requires knowing which C files actually exist
_extract-redist2017:
    just programs/extract-redist2017

# Cleans up sources-raw.json for use when benchmarking jlm-opt
create-sources-json: create-sources-raw-json _extract-redist2017
    ./process_sources_json.py --useRedist2017 --input sources-raw.json --output sources-redist2017.json
    ./process_sources_json.py --input sources-raw.json --output sources.json
