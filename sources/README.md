# Benchmarking sources
This folder contains the sources used for benchmarking.

### Open source benchmarks
The open source benchmarks have been downloaded from
 - Emacs 29.4: `https://ftpmirror.gnu.org/emacs/emacs-29.4.tar.gz`
 - Ghostscript 10.04.0: `https://github.com/ArtifexSoftware/ghostpdl-downloads/releases/download/gs10040/ghostscript-10.04.0.tar.gz`
 - gdb 15.2: `https://ftp.gnu.org/gnu/gdb/gdb-15.2.tar.gz`
 - sendmail 8.18.1: `https://ftp.sendmail.org/sendmail.8.18.1.tar.gz`

They are licenced as follows:
 - Emacs is licenced under GNU General Public Licence version 3.
 - Some parts of Ghostscript are GPL, while others are under the GNU Affero General Public License version 3 or later.
 - gdb is licenced under GNU General Public Licence version 3.
 - sendmail is licenced under the SENDMAIL LICENCE.

Full license documents for these programs can be found inside their respective archives.
They can all be found in the `programs/` folder.

### Polybench
 - TODO

### SPEC 2017 benchmarks
We use the following benchmarks from SPEC2017:
 - 500.perlbench
 - 502.gcc
 - 505.mcf
 - 507.cactuBSSN
 - 525.x264
 - 526.blender
 - 538.imagick
 - 557.xz
 - 544.nab

#### If you have a copy of SPEX2017
If you have a copy of `cpu2017.tar.xz`, place it in the folder next to `PLACE_cpu2017_tar_xz_HERE`.

#### If you do not have a copy
While SPEC 2017 is propriatary, they provide a folder called `redistributable_sources/`, containing both original and modified sources.
In `programs/redist2017/`, a relevant subset of this folder is included, using the modified versions when available.
We also include the `Docs/licences` folder, as it contains licencing information about all the programs and SPEC2017 itself.

A separate version of `sources.json`, called `sources-redist2017.json`, contains all the C compiler invocations,
translated and filtered to use the `redist2017/` versions instead.
The changes from actual SPEC2017 to `redist2017` are:
 - The benchmark `505.mcf` is skipped, as its sources are not included in `redistributable_sources/`.
 - `500.perlbench` uses the original perl source code, without SPEC's modifications.
   It also skips 28 of the C files, since they are not generated by default.
 - `538.imagick` uses the original ImageMagick source code, without SPEC's modifications.
   All files are included, and configuration is done using the same options as in SPEC.
 - The rest of the bechmarks are identical between `cpu2017` and `redist2017`.

### Extracting benchmarks
The following commands are automatically executed by the `./run.sh` script, but you can also execute them manually.

To extract the benchmarks from their tarballs, in the current directory run:

``` sh
just programs/extract-all-free

# If you do not have your own cpu2017.tar.xz 
just programs/extract-redist2017

# If you have provided cpu2017.tar.xz
just prorams/extract-cpu2017
```

### Creating sources.json for your machine
The file `sources-raw.json` contains all the compiler invocations used to build the programs,
created by tracing complete builds of the target programs.
The SPEC2017 traces were created from the `make.out` log files,
while the open source programs were traced using the `bear` utility.

If you are not using the provided Docker image, the build commands might not work on your system.
You can perform fresh builds and trace your own build commands, if you have provided a copy of `cpu2017.tar.xz`.
You need to have `llvm-config-18` in your PATH, as well as a lot of dependencies for the free benchmarks.
See `../Dockerfile` for list of suggestions.

From the root of the repository, create fresh sources json files using:

``` sh
./run.sh create-sources-json

# To create the original docker-based sources.json, run in the docker image
docker run -it --mount type=bind,source="$(pwd)",target=/benchmark jlm-benchmark-image ./run.sh create-sources-json
```


